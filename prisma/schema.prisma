generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Recipe {
  id           String             @id @default(uuid())
  title        String
  description  String
  creationDate DateTime           @default(now())
  servings     Int
  rating       Float?
  calories     Float
  imageId      String?
  userId       String
  cookingTime  CookingTime?
  Favorite     Favorite[]
  nutrients    Nutrients?
  image        File?              @relation(fields: [imageId], references: [id])
  user         User               @relation(fields: [userId], references: [id])
  categories   RecipeCategory[]
  ingredients  RecipeIngredient[]
  steps        RecipeStep[]
  reviews      Review[]
}

model Review {
  id           String   @id @default(uuid())
  rating       Float
  comment      String
  creationDate DateTime @default(now())
  recipeId     String
  userId       String
  recipe       Recipe   @relation(fields: [recipeId], references: [id])
  user         User     @relation(fields: [userId], references: [id])
}

model CookingTime {
  value    Float
  unit     String
  recipeId String @unique
  recipe   Recipe @relation(fields: [recipeId], references: [id])
}

model Ingredient {
  name             String             @id
  RecipeIngredient RecipeIngredient[]
}

model IngredientUnit {
  name             String             @id
  RecipeIngredient RecipeIngredient[]
}

model Category {
  name           String           @id
  RecipeCategory RecipeCategory[]
}

model RecipeCategory {
  id           String   @id @default(uuid())
  recipeId     String
  categoryName String
  category     Category @relation(fields: [categoryName], references: [name])
  recipe       Recipe   @relation(fields: [recipeId], references: [id])
}

model RecipeIngredient {
  id                 String         @id @default(uuid())
  amount             Float
  recipeId           String
  ingredientUnitName String
  ingredientName     String
  description        String?
  ingredient         Ingredient     @relation(fields: [ingredientName], references: [name])
  unit               IngredientUnit @relation(fields: [ingredientUnitName], references: [name])
  recipe             Recipe         @relation(fields: [recipeId], references: [id])
}

model Nutrients {
  id       String @id @default(uuid())
  fat      Float
  protein  Float
  carbs    Float
  recipeId String @unique
  recipe   Recipe @relation(fields: [recipeId], references: [id])
}

model RecipeStep {
  id       String @id @default(uuid())
  step     String
  order    Int
  recipeId String
  Recipe   Recipe @relation(fields: [recipeId], references: [id])

  @@unique([recipeId, order])
}

model Favorite {
  recipeId String
  userId   String
  Recipe   Recipe @relation(fields: [recipeId], references: [id])
  User     User   @relation(fields: [userId], references: [id])

  @@unique([recipeId, userId])
}

model File {
  id       String   @id @default(uuid())
  filename String
  path     String
  mimetype String
  Recipe   Recipe[]
}

model User {
  id                        String     @id @default(uuid())
  email                     String     @unique
  name                      String
  password                  String
  creationDate              DateTime   @default(now())
  currentHashedRefreshToken String?
  Favorite                  Favorite[]
  Recipe                    Recipe[]
  Review                    Review[]
}
